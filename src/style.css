:root {
  color-scheme: dark;
  font-family: Inter, 'Noto Sans SC', system-ui, sans-serif;
  --bg: #101418;
  --card: rgba(13, 18, 23, 0.92);
  --line: rgba(170, 196, 217, 0.22);
  --text: #e7eef3;
  --muted: #9aacbc;
  --accent: #7fb8de;
  --warn: #d8a45b;
  --danger: #d37a7a;
  --ok: #8ece9a;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html, body { margin: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg); color: var(--text); }

#app-canvas {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: block;
  touch-action: none;
  background: radial-gradient(circle at 20% 10%, #202830, #0f1318 60%);
}

.ui-layer { position: fixed; inset: 0; z-index: 8; pointer-events: none; }
.card { background: var(--card); border: 1px solid var(--line); border-radius: 14px; backdrop-filter: blur(6px); }
.btn, .action-btn, .chip, .input { min-height: 44px; border-radius: 12px; border: 1px solid var(--line); background: #1b232b; color: var(--text); }
.btn, .chip, .action-btn { padding: 8px 12px; font-weight: 600; }
.btn--active { background: #283d4f; border-color: #83b8df; }
.btn--danger { border-color: #7f4646; color: #f3c0c0; }

.top-bar {
  pointer-events: auto;
  margin: max(8px, env(safe-area-inset-top)) max(8px, env(safe-area-inset-right)) 0 max(8px, env(safe-area-inset-left));
  padding: 10px;
  display: grid;
  gap: 10px;
}
.top-bar__primary { display: grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: 8px; }
.metric { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 6px; display: flex; flex-direction: column; }
.metric span { font-size: 12px; color: var(--muted); }
.metric strong { font-size: 14px; }
.top-bar__actions { display: grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: 8px; }
.top-bar__settings { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.top-bar__settings label { display: grid; gap: 4px; font-size: 12px; color: var(--muted); }
.top-bar select, .input { width: 100%; padding: 8px; }

.status-pill { padding: 2px 8px; border-radius: 999px; }
.status-pill--通 { background: rgba(79, 160, 108, 0.25); color: #9de3ae; }
.status-pill--危 { background: rgba(188, 127, 64, 0.25); color: #ebc08c; }
.status-pill--断 { background: rgba(168, 75, 75, 0.22); color: #f1a8a8; }

.quick-jump { pointer-events: auto; margin: 6px 10px 0; padding: 8px; display: flex; gap: 8px; align-items: center; }

.unit-panel {
  pointer-events: auto;
  position: fixed;
  top: 154px;
  left: max(8px, env(safe-area-inset-left));
  bottom: calc(140px + env(safe-area-inset-bottom));
  width: min(340px, 34vw);
  padding: 10px;
  display: grid;
  grid-template-rows: auto auto auto 1fr;
  gap: 8px;
  overflow: hidden;
}
.unit-panel__head, .sheet-head { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.chips { display: flex; flex-wrap: wrap; gap: 6px; }
.chip { min-height: 36px; font-size: 12px; }
.chip--active { border-color: #9cc7e2; background: #273948; }
.unit-tree { overflow: auto; padding-right: 4px; }
.unit-node-list { display: grid; gap: 4px; margin: 4px 0 6px 10px; }
.unit-node { text-align: left; }
.unit-node--active { border-color: #e6c37b; background: #4a3f29; }
.empty { color: var(--muted); font-size: 13px; }

.info-sheet {
  pointer-events: auto;
  position: fixed;
  right: max(8px, env(safe-area-inset-right));
  top: 154px;
  width: min(360px, 35vw);
  padding: 10px;
}
.situation-cards { display: grid; gap: 8px; }
.s-card { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 8px; }
.s-card h4 { margin: 0 0 4px; }
.s-card p { margin: 0; color: var(--muted); }
.unit-card-grid { display: grid; gap: 8px; }
.unit-card-grid div { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 8px; }
.unit-card-grid span { color: var(--muted); display: block; font-size: 12px; }

.log-sheet {
  pointer-events: auto;
  position: fixed;
  right: max(8px, env(safe-area-inset-right));
  top: 380px;
  width: min(360px, 35vw);
  bottom: calc(140px + env(safe-area-inset-bottom));
  overflow: auto;
  padding: 10px;
}
.log-sheet ul { margin: 8px 0 0; padding-left: 20px; display: grid; gap: 6px; }

.action-dock {
  pointer-events: auto;
  position: fixed;
  left: max(8px, env(safe-area-inset-left));
  right: max(8px, env(safe-area-inset-right));
  bottom: max(8px, env(safe-area-inset-bottom));
  padding: 8px;
  display: grid;
  gap: 8px;
}
.action-dock__actions { display: grid; grid-template-columns: repeat(5, minmax(0,1fr)); gap: 8px; }
.action-btn { display: grid; justify-items: center; align-content: center; }
.action-btn small { color: var(--muted); }
.action-btn.is-disabled { opacity: 0.45; }
.action-dock__meta { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.confirm-strip {
  pointer-events: auto;
  position: fixed;
  left: max(8px, env(safe-area-inset-left));
  right: max(8px, env(safe-area-inset-right));
  bottom: calc(118px + env(safe-area-inset-bottom));
  padding: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.toast {
  position: fixed;
  left: 50%;
  bottom: calc(180px + env(safe-area-inset-bottom));
  transform: translate(-50%, 20px);
  opacity: 0;
  transition: opacity .14s, transform .14s;
  background: rgba(9, 12, 15, 0.95);
  border: 1px solid var(--line);
  border-radius: 999px;
  padding: 8px 14px;
  z-index: 20;
  pointer-events: none;
}
.toast.is-open { opacity: 1; transform: translate(-50%, 0); }

@media (max-width: 900px) {
  .top-bar__actions { grid-template-columns: repeat(2, minmax(0,1fr)); }
  .top-bar__primary { grid-template-columns: repeat(2, minmax(0,1fr)); }
  .unit-panel {
    width: auto;
    right: max(8px, env(safe-area-inset-right));
    top: auto;
    bottom: calc(140px + env(safe-area-inset-bottom));
    max-height: 52vh;
    transform: translateY(55%);
    transition: transform .16s;
  }
  .unit-panel:hover, .unit-panel:focus-within { transform: translateY(0); }
  .info-sheet, .log-sheet { width: auto; left: max(8px, env(safe-area-inset-left)); right: max(8px, env(safe-area-inset-right)); }
  .info-sheet { top: 310px; }
  .log-sheet { top: auto; bottom: calc(300px + env(safe-area-inset-bottom)); max-height: 24vh; }
  .action-dock__actions { grid-template-columns: repeat(3, minmax(0,1fr)); }
}
